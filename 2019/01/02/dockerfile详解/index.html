<!DOCTYPE html>













<html class="theme-next pisces" lang="zh-CN">
<head><meta name="generator" content="Hexo 3.8.0">
  <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=2">
<script src="//cdn.bootcss.com/pace/1.0.2/pace.min.js"></script>
<link href="//cdn.bootcss.com/pace/1.0.2/themes/pink/pace-theme-flash.css" rel="stylesheet">
<style>
    .pace .pace-progress {
        background: #1E92FB; /*进度条颜色*/
        height: 3px;
    }
    .pace .pace-progress-inner {
         box-shadow: 0 0 10px #1E92FB, 0 0 5px     #1E92FB; /*阴影颜色*/
    }
    .pace .pace-activity {
        border-top-color: #1E92FB;    /*上边框颜色*/
        border-left-color: #1E92FB;    /*左边框颜色*/
    }
</style>

<meta name="theme-color" content="#222">






  
  
    
    
  <script src="/lib/pace/pace.min.js?v=1.0.2"></script>
  <link href="/lib/pace/pace-theme-minimal.min.css?v=1.0.2" rel="stylesheet">







<meta http-equiv="Cache-Control" content="no-transform">
<meta http-equiv="Cache-Control" content="no-siteapp">





















<link href="/lib/font-awesome/css/font-awesome.min.css?v=4.6.2" rel="stylesheet" type="text/css">

<link href="/css/main.css?v=6.6.0" rel="stylesheet" type="text/css">


  <link rel="apple-touch-icon" sizes="180x180" href="/images/apple-touch-icon-next.png?v=6.6.0">


  <link rel="icon" type="image/png" sizes="32x32" href="/images/favicon.ico?v=6.6.0">


  <link rel="icon" type="image/png" sizes="16x16" href="/images/favicon-16x16-next.png?v=6.6.0">


  <link rel="mask-icon" href="/images/logo.svg?v=6.6.0" color="#222">









<script type="text/javascript" id="hexo.configurations">
  var NexT = window.NexT || {};
  var CONFIG = {
    root: '/',
    scheme: 'Pisces',
    version: '6.6.0',
    sidebar: {"position":"left","display":"post","offset":12,"b2t":false,"scrollpercent":true,"onmobile":false},
    fancybox: false,
    fastclick: false,
    lazyload: false,
    tabs: true,
    motion: {"enable":false,"async":false,"transition":{"post_block":"fadeIn","post_header":"slideDownIn","post_body":"slideDownIn","coll_header":"slideLeftIn","sidebar":"slideUpIn"}},
    algolia: {
      applicationID: '',
      apiKey: '',
      indexName: '',
      hits: {"per_page":10},
      labels: {"input_placeholder":"Search for Posts","hits_empty":"We didn't find any results for the search: ${query}","hits_stats":"${hits} results found in ${time} ms"}
    }
  };
</script>


  




  <script>
  (function(i,s,o,g,r,a,m){i["DaoVoiceObject"]=r;i[r]=i[r]||function(){(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;a.charset="utf-8";m.parentNode.insertBefore(a,m)})(window,document,"script",('https:' == document.location.protocol ? 'https:' : 'http:') + "//widget.daovoice.io/widget/0f81ff2f.js","daovoice")
  daovoice('init', {
      app_id: "Infinity"
    });
  daovoice('update');
  </script>

  <meta name="description" content="dockerfile详解">
<meta name="keywords" content="docker">
<meta property="og:type" content="article">
<meta property="og:title" content="dockerfile详解">
<meta property="og:url" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/index.html">
<meta property="og:site_name" content="Dai zhe&#39;s notes">
<meta property="og:description" content="dockerfile详解">
<meta property="og:locale" content="zh-CN">
<meta property="og:image" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/图标.png">
<meta property="og:image" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/分层.png">
<meta property="og:image" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/镜像分层.png">
<meta property="og:image" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/关于dockerfile.png">
<meta property="og:image" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/docker镜像制作的两种运行场景.png">
<meta property="og:image" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/2019-01-02_143308.png">
<meta property="og:updated_time" content="2019-01-05T03:56:29.299Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="dockerfile详解">
<meta name="twitter:description" content="dockerfile详解">
<meta name="twitter:image" content="https://daizhe.net.cn/2019/01/02/dockerfile详解/图标.png">



  <link rel="alternate" href="/atom.xml" title="Dai zhe's notes" type="application/atom+xml">




  <link rel="canonical" href="https://daizhe.net.cn/2019/01/02/dockerfile详解/">



<script type="text/javascript" id="page.configurations">
  CONFIG.page = {
    sidebar: "",
  };
</script>

  <title>dockerfile详解 | Dai zhe's notes</title>
  











  <noscript>
  <style type="text/css">
    .use-motion .motion-element,
    .use-motion .brand,
    .use-motion .menu-item,
    .sidebar-inner,
    .use-motion .post-block,
    .use-motion .pagination,
    .use-motion .comments,
    .use-motion .post-header,
    .use-motion .post-body,
    .use-motion .collection-title { opacity: initial; }

    .use-motion .logo,
    .use-motion .site-title,
    .use-motion .site-subtitle {
      opacity: initial;
      top: initial;
    }

    .use-motion {
      .logo-line-before i { left: initial; }
      .logo-line-after i { right: initial; }
    }
  </style>
</noscript>

</head>

<body itemscope="" itemtype="http://schema.org/WebPage" lang="zh-CN">
<link rel="stylesheet" href="/dist/APlayer.min.css">
<div id="aplayer"></div>
<script type="text/javascript" src="/dist/APlayer.min.js"></script>
<script type="text/javascript" src="/dist/music.js"></script>
  
  
    
  

  <div class="container sidebar-position-left page-post-detail">
    <div class="headband"></div>
    <header id="header" class="header" itemscope="" itemtype="http://schema.org/WPHeader">
      <div class="header-inner"><div class="site-brand-wrapper">
  <div class="site-meta ">
    

    <div class="custom-logo-site-title">
      <a href="/" class="brand" rel="start">
        <span class="logo-line-before"><i></i></span>
        <span class="site-title">Dai zhe's notes</span>
        <span class="logo-line-after"><i></i></span>
      </a>
    </div>
    
      
        <p class="site-subtitle">Just Du It</p>
      
    
  </div>

  <div class="site-nav-toggle">
    <button aria-label="切换导航栏">
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
      <span class="btn-bar"></span>
    </button>
  </div>
</div>



<nav class="site-nav">
  
    <ul id="menu" class="menu">
      
        
        
        
          
          <li class="menu-item menu-item-home">

    
    
    
      
    

    
      
    

    <a href="/" rel="section"><i class="menu-item-icon fa fa-fw fa-home"></i> <br>首页</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-about">

    
    
    
      
    

    
      
    

    <a href="/about/" rel="section"><i class="menu-item-icon fa fa-fw fa-address-card"></i> <br>关于</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-tags">

    
    
    
      
    

    
      
    

    <a href="/tags/" rel="section"><i class="menu-item-icon fa fa-fw fa-tags"></i> <br>标签<span class="badge">14</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-categories">

    
    
    
      
    

    
      
    

    <a href="/categories/" rel="section"><i class="menu-item-icon fa fa-fw fa-th"></i> <br>分类<span class="badge">11</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-archives">

    
    
    
      
    

    
      
    

    <a href="/archives/" rel="section"><i class="menu-item-icon fa fa-fw fa-archive"></i> <br>归档<span class="badge">40</span></a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-相册">

    
    
    
      
    

    
      
    

    <a href="/photos/" rel="section"><i class="menu-item-icon fa fa-fw fa-camera-retro"></i> <br>相册</a>

  </li>
        
        
        
          
          <li class="menu-item menu-item-书单&music">

    
    
    
      
    

    
      
    

    <a href="/shudan/" rel="section"><i class="menu-item-icon fa fa-fw fa-gratipay"></i> <br>书单&music</a>

  </li>

      
      
        <li class="menu-item menu-item-search">
          
            <a href="javascript:;" class="popup-trigger">
          
            
              <i class="menu-item-icon fa fa-search fa-fw"></i> <br>搜索</a>
        </li>
      
    </ul>
  

  

  
    <div class="site-search">
      
  <div class="popup search-popup local-search-popup">
  <div class="local-search-header clearfix">
    <span class="search-icon">
      <i class="fa fa-search"></i>
    </span>
    <span class="popup-btn-close">
      <i class="fa fa-times-circle"></i>
    </span>
    <div class="local-search-input-wrapper">
      <input autocomplete="off" placeholder="搜索..." spellcheck="false" type="text" id="local-search-input">
    </div>
  </div>
  <div id="local-search-result"></div>
</div>



    </div>
  
</nav>



  


</div>
    </header>

    <a href="https://github.com/Dz6666" class="github-corner" target="_blank" title="Follow me on GitHub" aria-label="Follow me on GitHub">
      <svg width="80" height="80" viewbox="0 0 250 250" style="fill:#222; color:#fff; position: absolute; top: 0; border: 0; right: 0;" aria-hidden="true">
        <path d="M0,0 L115,115 L130,115 L142,142 L250,250 L250,0 Z"/><path d="M128.3,109.0 C113.8,99.7 119.0,89.6 119.0,89.6 C122.0,82.7 120.5,78.6 120.5,78.6 C119.2,72.0 123.4,76.3 123.4,76.3 C127.3,80.9 125.5,87.3 125.5,87.3 C122.9,97.6 130.6,101.9 134.4,103.2" fill="currentColor" style="transform-origin: 130px 106px;" class="octo-arm"/>
    <path d="M115.0,115.0 C114.9,115.1 118.7,116.5 119.8,115.4 L133.7,101.6 C136.9,99.2 139.9,98.4 142.2,98.6 C133.8,88.0 127.5,74.4 143.8,58.0 C148.5,53.4 154.0,51.2 159.7,51.0 C160.3,49.4 163.2,43.6 171.4,40.1 C171.4,40.1 176.1,42.5 178.8,56.2 C183.1,58.6 187.2,61.8 190.9,65.4 C194.5,69.0 197.7,73.2 200.1,77.6 C213.8,80.2 216.3,84.9 216.3,84.9 C212.7,93.1 206.9,96.0 205.4,96.6 C205.1,102.4 203.0,107.8 198.3,112.5 C181.9,128.9 168.3,122.5 157.7,114.1 C157.9,116.9 156.7,120.9 152.7,124.9 L141.0,136.5 C139.8,137.7 141.6,141.9 141.8,141.8 Z" fill="currentColor" class="octo-body"/>
      </svg>
      </a>

    


    <main id="main" class="main">
      <div class="main-inner">
        <div class="content-wrap">
          
            

          
          <div id="content" class="content">
            

  <div id="posts" class="posts-expand">
    

  

  
  
  

  

  <article class="post post-type-normal" itemscope="" itemtype="http://schema.org/Article">
  
  
  
  <div class="post-block">
    <link itemprop="mainEntityOfPage" href="https://daizhe.net.cn/2019/01/02/dockerfile详解/">

    <span hidden itemprop="author" itemscope="" itemtype="http://schema.org/Person">
      <meta itemprop="name" content="哆啦A梦">
      <meta itemprop="description" content="More than that">
      <meta itemprop="image" content="/images/haha.gif">
    </span>

    <span hidden itemprop="publisher" itemscope="" itemtype="http://schema.org/Organization">
      <meta itemprop="name" content="Dai zhe's notes">
    </span>

    
      <header class="post-header">

        
        
          <h1 class="post-title" itemprop="name headline">dockerfile详解
              
            
          </h1>
        

        <div class="post-meta">
                  
            <i class="fa fa-thumb-tack"></i>
            <font color="808080">置顶</font>
            <span class="post-meta-divider">|</span>
          
          <span class="post-time">

            
            
            

            
              <span class="post-meta-item-icon">
                <i class="fa fa-calendar-o"></i>
              </span>
              
                <span class="post-meta-item-text">发表于</span>
              

              
                
              

              <time title="创建时间：2019-01-02 19:20:29" itemprop="dateCreated datePublished" datetime="2019-01-02T19:20:29+08:00">2019-01-02</time>
            

            
          </span>

          
            <span class="post-category">
            
              <span class="post-meta-divider">|</span>
            
              <span class="post-meta-item-icon">
                <i class="fa fa-folder-o"></i>
              </span>
              
                <span class="post-meta-item-text">分类于</span>
              
              
                <span itemprop="about" itemscope="" itemtype="http://schema.org/Thing"><a href="/categories/docker/" itemprop="url" rel="index"><span itemprop="name">docker</span></a></span>

                
                
              
            </span>
          

          
            
              <span class="post-comments-count">
                <span class="post-meta-divider">|</span>
                <span class="post-meta-item-icon">
                  <i class="fa fa-comment-o"></i>
                </span>
                <a href="/2019/01/02/dockerfile详解/#comments" itemprop="discussionUrl">
                  <span class="post-meta-item-text">评论数：</span> <span class="post-comments-count valine-comment-count" data-xid="/2019/01/02/dockerfile详解/" itemprop="commentCount"></span>
                </a>
              </span>
            
          

          
          

          

          
            <div class="post-symbolscount">
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-file-word-o"></i>
                </span>
                
                  <span class="post-meta-item-text">本文字数：</span>
                
                <span title="本文字数">37k</span>
              

              
                <span class="post-meta-divider">|</span>
              

              
                <span class="post-meta-item-icon">
                  <i class="fa fa-clock-o"></i>
                </span>
                
                  <span class="post-meta-item-text">阅读时长 &asymp;</span>
                
                <span title="阅读时长">34 分钟</span>
              
            </div>
          

          

        </div>
      </header>
    

    
    
    
    <div class="post-body" itemprop="articleBody">

      
      

      
        <h1 id="dockerfile详解"><a href="#dockerfile详解" class="headerlink" title="dockerfile详解"></a>dockerfile详解</h1><p><img src="/2019/01/02/dockerfile详解/图标.png" alt=""><br><a id="more"></a></p>
<h2 id="docker的镜像分层"><a href="#docker的镜像分层" class="headerlink" title="docker的镜像分层"></a>docker的镜像分层</h2><ul>
<li><p>分层</p>
<ul>
<li>Cow</li>
<li>联合挂载</li>
<li>base image ,app image = base image</li>
</ul>
</li>
<li><p>docker里的镜像绝大部分都是在别的镜像的基础上去进行创建的，也就是使用镜像的分层结构。</p>
</li>
<li>那么为什么会有两个镜像呢？这是由于docker的镜像分层结构所导致的，如下图所示。</li>
</ul>
<p><img src="/2019/01/02/dockerfile详解/分层.png" alt=""></p>
<ul>
<li><p>一个docker镜像由多个可读的镜像层组成，然后运行的容器会在这个docker的镜像上面多加一层可写的容器层，任何的对文件的更改都只存在此容器层。因此任何对容器的操作均不会影响到镜像。</p>
</li>
<li><p>至于容器如何获取镜像层文件而又不影响到是镜像层的呢？docker是这样实现的？</p>
</li>
<li>如果需要获取某个文件，那么容器曾会从上到下去下一层的镜像层去获取文件，如果该层文件不存在，那么就会去下一镜像层去寻找，直到最后一层。</li>
<li>对于用户而言，用户面向的是一个叠加后的文件系统。</li>
<li>而任何对于文件的操作都会记录在容器层，例如说修改文件，容器层会把在镜像层找到的文件拷贝到容器层然后进行修改，删除文件则会在容器层内记录删除文件的记录。</li>
</ul>
<p><img src="/2019/01/02/dockerfile详解/镜像分层.png" alt=""></p>
<h2 id="About-Dockerfile"><a href="#About-Dockerfile" class="headerlink" title="About Dockerfile"></a>About Dockerfile</h2><ul>
<li>Dockerfile只不过是建造码头工人的源代码自动图像码头工人可以构建图像读取指令从Dockerfile。<ul>
<li>Dockerfile是一个文本文件,包含所有的命令在命令行用户可以叫组装一个图像型码头工人建立用户可以创建一个自动构建执行一些命令行指令</li>
</ul>
</li>
</ul>
<p><img src="/2019/01/02/dockerfile详解/关于dockerfile.png" alt=""></p>
<h2 id="Dockerfile"><a href="#Dockerfile" class="headerlink" title="Dockerfile"></a>Dockerfile</h2><ul>
<li>Dockerfile其实可以看做一个命令集。每行均为一条命令。每行的第一个单词，就是命令command。</li>
<li>后面的字符串是该命令所要接收的参数。</li>
<li>比如ENTRYPOINT /bin/bash。ENTRYPOINT命令的作用就是将后面的参数设置为镜像的entrypoint。</li>
<li>至于现有命令的含义，这里不再详述。</li>
<li>DockOne上有很多的介绍。</li>
</ul>
<p>一、Docker Image building</p>
<ul>
<li><p>宿主机指定工作目录：</p>
<ul>
<li>1.此文件中仅用于放置Dockerfile以及Dockerfile文件中指定要被依赖到的文件，不要放置其他文件或目录。</li>
<li>2.此宿主机的工作目录相当于隐式运行的容器的卷，仅能从此卷中复制文件到容器中。</li>
</ul>
</li>
<li><p>Dockerfile的文件名也只能叫做Dockerfile，放置在宿主机上的工作目录中。</p>
</li>
</ul>
<p>二、Dockerfile文件格式</p>
<ul>
<li>格式（Format）<ul>
<li>#注释</li>
<li>指令参数</li>
</ul>
</li>
<li>该指令本身不区分字符大小<ul>
<li>惯例要求的指令要写成纯大写</li>
<li>以便更容易地与参数区分开来</li>
</ul>
</li>
<li>dockerfile文件本身没有循环、选择等分支，也没有跳转语句<ul>
<li>一般来讲在dockerfile文件中的第一条指令是“FROM”（新版的dockerfile有松动，早期的dockerfile把第一条执行的第一条指令必须是“FROM”），因为“FROM”就是我们用来指定基础镜像的。</li>
</ul>
</li>
</ul>
<p>三、Dockerfile的镜像层构建</p>
<ul>
<li>在dockerfile中构建镜像，与我们手动的显式的启动一个容器构建镜像不同的是dockerfile文件中的每一条指令都会生成一个新的单有的镜像层。<ul>
<li>分层过多会导致在读写访问过程中的效率降低，因为首次访问镜像一定是Cow机制完成</li>
<li>镜像分的过于精细的好处是可以其他让镜像让享同一层底层的镜像即镜像层越精细越多越容易共享，越容易共享代表在镜像仓库与客户端和dockerhost之间传输时可以单独传输，传输的过程越易控，起码在打包、分发。</li>
<li>应该把关系比较紧密的操作放置在一层操作当中。</li>
</ul>
</li>
</ul>
<h3 id="docker镜像制作的两种运行场景"><a href="#docker镜像制作的两种运行场景" class="headerlink" title="docker镜像制作的两种运行场景"></a><code>docker镜像制作的两种运行场景</code></h3><ul>
<li>制作新镜像的过程</li>
<li>运行新镜像的阶段</li>
</ul>
<p><img src="/2019/01/02/dockerfile详解/docker镜像制作的两种运行场景.png" alt=""></p>
<h2 id="dockerfile"><a href="#dockerfile" class="headerlink" title="dockerfile"></a>dockerfile</h2><h3 id="环境变量"><a href="#环境变量" class="headerlink" title="环境变量"></a>环境变量</h3><ul>
<li>环境变量(用ENV语句声明)也可以在某些指令中使用，因为Dockerfile将解释的变量在Dockerfile中以$variable名或${variable_name标记<ul>
<li>${variable_name} 语法还支持一些标准的bash修饰符<ul>
<li><code>$ivariable:-word} 表示如果设置了变量，则结果将是该值。
如果变量没有设置，那么结果将是word</code>  </li>
<li>${variable:+word} 表示如果设置了变量，则word为结果，否则结果为空字符串</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="dockerignore-file"><a href="#dockerignore-file" class="headerlink" title=".dockerignore file"></a>.dockerignore file</h3><p>在docker CLI将上下文发送给docker守护进程之前，它将查找一个名为。如果该文件存在，CLI将修改该上下文以排除与其模式匹配的文件和目录。dockerignore file是一个以新行分隔的模式列表，类似于Unix shell的文件全局</p>
<h2 id="Dockerfile指令"><a href="#Dockerfile指令" class="headerlink" title="Dockerfile指令"></a><code>Dockerfile指令</code></h2><h3 id="build阶段Dockerfile文件中的指令"><a href="#build阶段Dockerfile文件中的指令" class="headerlink" title="build阶段Dockerfile文件中的指令"></a><code>build阶段Dockerfile文件中的指令</code></h3><p>(build阶段：做很多设定以便于在目标镜像文件中可以打包进入所期望的文件或者程序文件)</p>
<ul>
<li><p><code>FROM</code> </p>
<ul>
<li>FROM指令是最重的一个且必须为Dockerfile文件开篇的第一个非注释行，用于 为映像文件构建过程指定基准镜像，后续的指令运行于此基准镜像所提供的运 行环境 </li>
<li>实践中，基准镜像可以是任何可用镜像文件，默认情况下，docker build会在 docker主机上查找指定的镜像文件，在其不存在时，则会从Docker Hub Registry 上拉取所需的镜像文件 <ul>
<li>如果找不到指定的镜像文件，docker build会返回一个错误信息 </li>
</ul>
</li>
<li>Syntax(语法)(repository仓库、tag标签、digest唯一标识id即镜像校验码)<ul>
<li><code>FROM &lt;repository&gt;[:&lt;tag&gt;] 或</code> </li>
<li><code>FROM &lt;resository&gt;@&lt;digest&gt;</code> <ul>
<li><code>&lt;reposotiry&gt;：指定作为base image的名称；</code> </li>
<li><code>&lt;tag&gt;：base image的标签，为可选项，省略时默认为latest；</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>LABEL</code></p>
<ul>
<li>用于让Dockerfile制作者提供本人的详细信息(支持提供此镜像的任何制作的附加介绍信息以及附加的元数据)</li>
<li><code>Syntax: LABEL &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; &lt;key&gt;=&lt;value&gt; ...</code></li>
</ul>
</li>
<li><p><code>COPY</code> </p>
<ul>
<li>用于从Docker主机复制文件至创建的新映像文件 </li>
<li>Syntax(语法) <ul>
<li><code>COPY &lt;src&gt; ... &lt;dest&gt; 或</code> </li>
<li><code>COPY [&quot;&lt;src&gt;&quot;,... &quot;&lt;dest&gt;&quot;]</code> <ul>
<li><code>&lt;src&gt;：要复制的源文件或目录，支持使用通配符</code> </li>
<li><code>&lt;dest&gt;：目标路径，即正在创建的image的文件系统路径；建议为&lt;dest&gt;使用绝对路径，否则， COPY指定则以WORKDIR为其起始路径；</code> </li>
</ul>
</li>
<li>注意：在路径中有空白字符时，通常使用第二种格式 </li>
</ul>
</li>
<li>文件复制准则 <ul>
<li><code>&lt;src&gt;必须是build上下文中的路径，不能是其父目录中的文件</code> </li>
<li><code>如果&lt;src&gt;是目录，则其内部文件或子目录会被递归复制，但&lt;src&gt;目录自身不会被复制</code> </li>
<li><code>如果指定了多个&lt;src&gt;，或在&lt;src&gt;中使用了通配符，则&lt;dest&gt;必须是一个目录，且必须以/ 结尾</code> </li>
<li><code>如果&lt;dest&gt;事先不存在，它将会被自动创建，这包括其父目录路径</code></li>
</ul>
</li>
</ul>
</li>
<li><p><code>ADD</code> </p>
<ul>
<li>ADD指令类似于COPY指令，ADD支持使用TAR文件和URL路径 </li>
<li>Syntax <ul>
<li><code>ADD &lt;src&gt; ... &lt;dest&gt; 或</code> </li>
<li><code>ADD [&quot;&lt;src&gt;&quot;,...  &quot;&lt;dest&gt;&quot;]</code> </li>
</ul>
</li>
<li>操作准则 <ul>
<li>同COPY指令 </li>
<li><code>如果&lt;src&gt;为URL且&lt;dest&gt;不以/结尾，则&lt;src&gt;指定的文件将被下载并直接被创建为&lt;dest&gt; ；如果&lt;dest&gt;以/结尾，则文件名URL指定的文件将被直接下载并保存为&lt;dest&gt;/&lt;filename&gt;</code> </li>
<li><code>如果&lt;src&gt;是一个本地系统上的压缩格式的tar文件，它将被展开为一个目录，其行为类似于 “tar -x”命令；然而，通过URL获取到的tar文件将不会自动展开</code>； </li>
<li><code>如果&lt;src&gt;有多个，或其间接或直接使用了通配符，则&lt;dest&gt;必须是一个以/结尾的目录路径 ；如果&lt;dest&gt;不以/结尾，则其被视作一个普通文件，&lt;src&gt;的内容将被直接写入到&lt;dest&gt;；</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<ul>
<li><p><code>WORKDIR</code> </p>
<ul>
<li>用于为Dockerfile中所有的RUN、CMD、ENTRYPOINT、COPY和ADD指定 设定工作目录 </li>
<li>Syntax <ul>
<li><code>WORKDIR &lt;dirpath&gt;</code> </li>
<li>在Dockerfile文件中，WORKDIR指令可出现多次，其路径也可以为相对路径，不过，其是相对此前 一个WORKDIR指令指定的路径 </li>
<li>另外，WORKDIR也可调用由ENV指定定义的变量 </li>
</ul>
</li>
<li>例如 <ul>
<li>WORKDIR /var/log </li>
<li>WORKDIR $STATEPATH</li>
</ul>
</li>
</ul>
</li>
<li><p><code>VOLUME 存储卷</code></p>
<ul>
<li>用于在image中创建一个挂载点目录，以挂载Docker host上的卷或其它容器上的 卷 </li>
<li>Syntax <ul>
<li><code>VOLUME &lt;mountpoint&gt; 或</code> </li>
<li><code>VOLUME [&quot;&lt;mountpoint&gt;&quot;]</code></li>
</ul>
</li>
<li>如果挂载点目录路径下此前在文件存在，docker run命令会在卷挂载完成后将此 前的所有文件复制到新挂载的卷中</li>
</ul>
</li>
<li><p><code>EXPOSE</code> </p>
<ul>
<li><code>用于为容器打开指定要监听的端口以实现与外部通信</code></li>
<li>Syntax <ul>
<li><code>EXPOSE &lt;port&gt;[/&lt;protocol&gt;] [&lt;port&gt;[/&lt;protocol&gt;] ...]</code><ul>
<li><code>&lt;protocol&gt;用于指定传输层协议，可为tcp或udp二者之一，默认为TCP协议,空格分隔可以创建多个</code> </li>
</ul>
</li>
</ul>
</li>
<li>EXPOSE指令可一次指定多个端口，<ul>
<li>例如 </li>
<li>EXPOSE 11211/udp 11211/tcp</li>
</ul>
</li>
</ul>
</li>
<li><p><code>ENV</code> </p>
<ul>
<li>用于为镜像定义所需的环境变量，并可被Dockerfile文件中位于其后的其它指令 （如ENV、ADD、COPY等）所调用 <ul>
<li>调用格式为$variable_name或${variable_name} </li>
<li>Syntax <ul>
<li><code>ENV &lt;key&gt; &lt;value&gt; 或</code> </li>
<li><code>ENV &lt;key&gt;=&lt;value&gt; ...</code> </li>
<li><code>第一种格式中，&lt;key&gt;之后的所有内容均会被视作其&lt;value&gt;的组成部分，因此，一次只 能设置一个变量；</code> </li>
<li><code>第二种格式可用一次设置多个变量，每个变量为一个&quot;&lt;key&gt;=&lt;value&gt;&quot;的键值对，如果 &lt;value&gt;中包含空格，可以以反斜线(\)进行转义，也可通过对&lt;value&gt;加引号进行标识；另 外，反斜线也可用于续行；</code> </li>
<li><code>定义多个变量时，建议使用第二种方式，以便在同一层中完成所有功能</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>ARG</code></p>
<ul>
<li>ARG指令定义了一个变量，用户可以在构建时将该变量传递给然后使用 `–bulis-arg<varname>=<value> flag</value></varname></li>
<li><p>如果用户指定了一个没有在dockerfile中定义的构建参数,构建输出一个警告.`</p>
</li>
<li><p>syntax</p>
<ul>
<li><code>ARG&lt;name&gt;[&lt;default value&gt;]</code></li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>1.使用FROM、LABEL、COPY制作镜像</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#############################################################</span></span><br><span class="line"><span class="comment">##########################创建docker的工作目录#################</span></span><br><span class="line"><span class="comment">##############################################################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># mkdir /docker/</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cd /docker/</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##############################################################</span></span><br><span class="line"><span class="comment">#########################编写dockerfile#######################</span></span><br><span class="line"><span class="comment">##############################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim Dockerfile</span></span><br><span class="line"></span><br><span class="line">FROM     busybox:latest             <span class="comment">#对宿主机上已有的哪个镜像进行创建</span></span><br><span class="line"></span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span>  <span class="comment">#作者描述</span></span><br><span class="line"></span><br><span class="line">COPY    index.html /data/web/html/       <span class="comment">#将宿主机上docker目录下的index.html文件复制到容器中的/data/web/html/目录。如果写为/data/web/html则代表将 index.html改名为html，在容器中的/data/web/html/获取并未存在，可以自动创建。</span></span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"><span class="comment">##################查看宿主机上的dockerfile的工作目录#############</span></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"></span><br><span class="line">[root@centos7 ~]<span class="comment"># cd /docker/</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># echo "123456" &gt; index.html</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># ls</span></span><br><span class="line">index.html</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">#########################构建新的镜像############################</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">dicker image build = docker build</span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build -h</span></span><br><span class="line">Usage:	docker image build [OPTIONS] PATH | URL | -</span><br><span class="line">Options:</span><br><span class="line">      --add-host list           添加自定义主机到ip映射(主机:ip)</span><br><span class="line">      --build-arg list          设置构建时变量</span><br><span class="line">      --cache-from strings      将图像视为缓存源</span><br><span class="line">      --rm                      成功构建后删除中间容器(默认为<span class="literal">true</span>)</span><br><span class="line">  -t, --tag list                制定的新的镜像设置新的仓库名和标签<span class="string">'name:tag'</span> </span><br><span class="line"></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.1        #执行命令的目录，要求写dockerfile文件所在的目录中</span></span><br><span class="line">Sending build context to Docker daemon  3.072kB</span><br><span class="line">Step 1/3 : FROM	 busybox:latest</span><br><span class="line"> ---&gt; 3a093384ac30</span><br><span class="line">Step 2/3 : LABEL 	maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 746880c7205c</span><br><span class="line">Removing intermediate container 746880c7205c</span><br><span class="line"> ---&gt; 7ccdca9907ce</span><br><span class="line">Step 3/3 : COPY	index.html /data/web/html/</span><br><span class="line"> ---&gt; 7062cd4f08e0</span><br><span class="line">Successfully built 7062cd4f08e0</span><br><span class="line">Successfully tagged mybox:v0.1</span><br><span class="line">    </span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">mybox                    v0.1                7062cd4f08e0 </span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">############基于创建的镜像启动容器查看COPY的文件是否存在############</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc1 -it --rm mybox:v0.1 /bin/sh</span></span><br><span class="line">/ <span class="comment"># cat /data/web/html/index.html </span></span><br><span class="line">123456</span><br></pre></td></tr></table></figure></p>
<p><code>2.COPY本身也是可以是可以支持通配符</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##############################################################</span></span><br><span class="line"><span class="comment">####################使用.dockerignore限制copy的文件#############</span></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># pwd</span></span><br><span class="line">/docker</span><br><span class="line">[root@centos7 docker]<span class="comment"># mkdir /docker/data/</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># cd !$</span></span><br><span class="line"><span class="built_in">cd</span> /docker/data/</span><br><span class="line">[root@centos7 data]<span class="comment"># echo "123" &gt; test1.html</span></span><br><span class="line">[root@centos7 data]<span class="comment"># echo "123" &gt; test2.html</span></span><br><span class="line">[root@centos7 data]<span class="comment"># echo "123" &gt; test3.html</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># tree</span></span><br><span class="line">.</span><br><span class="line">├── data</span><br><span class="line">│   ├── test1.html</span><br><span class="line">│   ├── test2.html</span><br><span class="line">│   └── test3.html</span><br><span class="line">└── Dockerfile</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">##打算将/docker/data/目录下的文件全部复制到容器中排除test3.html文件##</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim .dockerignore    #定义的.dockerignore 文件要写Dockerfile的相对路径，文件内也支持通配符</span></span><br><span class="line">data/test3.html</span><br><span class="line"></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line"><span class="comment">######################编辑Dockerfile文件##########################</span></span><br><span class="line"><span class="comment">#################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim /docker/Dockerfile </span></span><br><span class="line">FROM     busybox:latest</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">COPY    data /data/web/html/                <span class="comment">#如果源是目录会cp源目录下的文件不会cp目录本身</span></span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">##########################创建新的镜像###########################</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.4</span></span><br><span class="line">Sending build context to Docker daemon  5.632kB</span><br><span class="line">Step 1/3 : FROM	 busybox:latest</span><br><span class="line"> ---&gt; 3a093384ac30</span><br><span class="line">Step 2/3 : LABEL 	maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ccdca9907ce</span><br><span class="line">Step 3/3 : COPY	data /data/web/html/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 5b5cd427fb81</span><br><span class="line">Successfully built 5b5cd427fb81</span><br><span class="line">Successfully tagged mybox:v0.4</span><br><span class="line"></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line"><span class="comment">##############################创建容器查看######################</span></span><br><span class="line"><span class="comment">###############################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc1 -it --rm mybox:v0.4 /bin/sh</span></span><br><span class="line">/ <span class="comment"># ls /data/web/html/*</span></span><br><span class="line">/data/web/html/test1.html  /data/web/html/test2.html</span><br></pre></td></tr></table></figure></p>
<p><code>3.Dockerflie文件中ADD指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 docker]<span class="comment"># pwd</span></span><br><span class="line">/docker</span><br><span class="line">[root@centos7 docker]<span class="comment"># ls</span></span><br><span class="line">Dockerfile  wordpress-4.9-zh_CN.tar.gz</span><br><span class="line"></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM     busybox:latest</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">ADD http://nginx.org/download/nginx-1.14.2.tar.gz /data/ <span class="comment">#将网上的url打入镜像中，并运行容器是自动下载此压缩包放置在容器中的/data目录中</span></span><br><span class="line">ADD wordpress-4.9-zh_CN.tar.gz /data2/  <span class="comment">#此压缩包是放置在docker的工作目录中，会在容器运行时解压到容器中/data2目录中。</span></span><br><span class="line"></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.3</span></span><br><span class="line">Sending build context to Docker daemon  10.13MB</span><br><span class="line">Step 1/4 : FROM	 busybox:latest</span><br><span class="line"> ---&gt; 3a093384ac30</span><br><span class="line">Step 2/4 : LABEL 	maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ccdca9907ce</span><br><span class="line">Step 3/4 : ADD http://nginx.org/download/nginx-1.14.2.tar.gz /data/</span><br><span class="line">Downloading  1.015MB/1.015MB</span><br><span class="line"> ---&gt; 62b1d80179e4</span><br><span class="line">Step 4/4 : ADD wordpress-4.9-zh_CN.tar.gz /data2/</span><br><span class="line"> ---&gt; 6bfaa9b46d21</span><br><span class="line">Successfully built 6bfaa9b46d21</span><br><span class="line">Successfully tagged mybox:v0.3</span><br><span class="line"></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc1 -it --rm mybox:v0.3 /bin/sh</span></span><br><span class="line">/ <span class="comment"># ls /data</span></span><br><span class="line">data/   data2/</span><br><span class="line">/ <span class="comment"># ls /data</span></span><br><span class="line">nginx-1.14.2.tar.gz</span><br><span class="line">/ <span class="comment"># ls /data2</span></span><br><span class="line">wordpress</span><br></pre></td></tr></table></figure></p>
<p><code>4.Dockerfile文件中WORKDIR指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">###########################定义工作目录##########################</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM     busybox:latest</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">WORKDIR /         <span class="comment">#定义工作目录，表示/data/</span></span><br><span class="line">ADD http://nginx.org/download/nginx-1.14.2.tar.gz data/</span><br><span class="line">WORKDIR /data/    <span class="comment">#定义工作目录，表示/data/haha/</span></span><br><span class="line">ADD wordpress-4.9-zh_CN.tar.gz haha/</span><br><span class="line"></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line"><span class="comment">###########################制作镜像并运行查看######################</span></span><br><span class="line"><span class="comment">################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.4</span></span><br><span class="line">Sending build context to Docker daemon  10.13MB</span><br><span class="line">Step 1/6 : FROM	 busybox:latest</span><br><span class="line"> ---&gt; 3a093384ac30</span><br><span class="line">Step 2/6 : LABEL 	maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ccdca9907ce</span><br><span class="line">Step 3/6 : WORKDIR /</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> a9ef74256526</span><br><span class="line">Removing intermediate container a9ef74256526</span><br><span class="line"> ---&gt; 89e2798cf96c</span><br><span class="line">Step 4/6 : ADD http://nginx.org/download/nginx-1.14.2.tar.gz data/</span><br><span class="line">Downloading  1.015MB/1.015MB</span><br><span class="line"> ---&gt; 653df7aeb99b</span><br><span class="line">Step 5/6 : WORKDIR /data/</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 55e4223e543c</span><br><span class="line">Removing intermediate container 55e4223e543c</span><br><span class="line"> ---&gt; 471c356643dc</span><br><span class="line">Step 6/6 : ADD wordpress-4.9-zh_CN.tar.gz haha/</span><br><span class="line"> ---&gt; c1d30647ca27</span><br><span class="line">Successfully built c1d30647ca27</span><br><span class="line">Successfully tagged mybox:v0.4</span><br><span class="line"></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc1 -it --rm  mybox:v0.4 /bin/sh</span></span><br><span class="line">/data <span class="comment"># ls /data/</span></span><br><span class="line">haha                 nginx-1.14.2.tar.gz</span><br><span class="line">/data <span class="comment"># ls /data/haha/</span></span><br><span class="line">wordpress</span><br></pre></td></tr></table></figure></p>
<p><code>5.Dockerfile文件中VOLUME指定存储卷指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><span class="line">docker管理的卷（要是想要指定绑定在宿主机的某个目录进行映射关联关系的存储卷继续使用-v选项指定）</span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"><span class="comment">##############################docker管理的卷#############################</span></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM     busybox:latest</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">WORKDIR /</span><br><span class="line">ADD http://nginx.org/download/nginx-1.14.2.tar.gz data/</span><br><span class="line">WORKDIR /data/</span><br><span class="line">ADD wordpress-4.9-zh_CN.tar.gz haha/</span><br><span class="line">VOLUME /data/web/html          <span class="comment">#指定容器中的此目录与宿主机上的某一个目录做存储卷映射关系</span></span><br><span class="line"></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line"><span class="comment">###############################打镜像--运行容器########################</span></span><br><span class="line"><span class="comment">######################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.5</span></span><br><span class="line">Sending build context to Docker daemon  10.15MB</span><br><span class="line">Step 1/7 : FROM	 busybox:latest</span><br><span class="line"> ---&gt; 3a093384ac30</span><br><span class="line">Step 2/7 : LABEL 	maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 7ccdca9907ce</span><br><span class="line">Step 3/7 : WORKDIR /</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 89e2798cf96c</span><br><span class="line">Step 4/7 : ADD http://nginx.org/download/nginx-1.14.2.tar.gz data/</span><br><span class="line">Downloading  1.015MB/1.015MB</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 653df7aeb99b</span><br><span class="line">Step 5/7 : WORKDIR /data/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; 471c356643dc</span><br><span class="line">Step 6/7 : ADD wordpress-4.9-zh_CN.tar.gz haha/</span><br><span class="line"> ---&gt; Using cache</span><br><span class="line"> ---&gt; c1d30647ca27</span><br><span class="line">Step 7/7 : VOLUME /data/web/html</span><br><span class="line"> ---&gt; Running <span class="keyword">in</span> 388c0312f897</span><br><span class="line">Removing intermediate container 388c0312f897</span><br><span class="line"> ---&gt; 54cf9694d119</span><br><span class="line">Successfully built 54cf9694d119</span><br><span class="line">Successfully tagged mybox:v0.5</span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc1 -it --rm  mybox:v0.5 /bin/sh</span></span><br><span class="line">/data <span class="comment"># ls /data/web/html/</span></span><br><span class="line">/data <span class="comment"># </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">##########################宿主机上查看对应的随机的存储卷##################</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker image inspect mybox:v0.5</span></span><br><span class="line">            <span class="string">"Volumes"</span>: &#123;</span><br><span class="line">                <span class="string">"/data/web/html/"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">[root@centos7 ~]<span class="comment"># docker container inspect pc1</span></span><br><span class="line">        <span class="string">"Mounts"</span>: [</span><br><span class="line">            &#123;</span><br><span class="line">                <span class="string">"Type"</span>: <span class="string">"volume"</span>,</span><br><span class="line">                <span class="string">"Name"</span>: <span class="string">"177fd037174ad4af75866df8d07c575f1e4dbee2ee65613c6e36842b4e6de49e"</span>,</span><br><span class="line">                <span class="string">"Source"</span>: <span class="string">"/var/lib/docker/volumes/177fd037174ad4af75866df8d07c575f1e4dbee2ee65613c6e36842b4e6de49e/_data"</span>,</span><br><span class="line">                <span class="string">"Destination"</span>: <span class="string">"/data/web/html"</span>,</span><br><span class="line">                <span class="string">"Driver"</span>: <span class="string">"local"</span>,</span><br><span class="line">                <span class="string">"Mode"</span>: <span class="string">""</span>,</span><br><span class="line">                <span class="string">"RW"</span>: <span class="literal">true</span>,</span><br><span class="line">                <span class="string">"Propagation"</span>: <span class="string">""</span></span><br><span class="line">            &#125;</span><br></pre></td></tr></table></figure></p>
<p><code>6.Dockerfile中EXPOSE指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">#########################编写Dockerfile端口暴露tcp80####################</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM     busybox:latest</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">WORKDIR /</span><br><span class="line">ADD http://nginx.org/download/nginx-1.14.2.tar.gz data/</span><br><span class="line">WORKDIR /data/</span><br><span class="line">ADD wordpress-4.9-zh_CN.tar.gz haha/</span><br><span class="line">VOLUME /data/web/html</span><br><span class="line">EXPOSE 80/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line"><span class="comment">#########################创建镜像并运行查看端口是否暴露###################</span></span><br><span class="line"><span class="comment">#######################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.6</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc1 -it --rm  mybox:v0.6 /bin/sh</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker container inspect pc1</span></span><br><span class="line">        <span class="string">"Config"</span>: &#123;</span><br><span class="line">            <span class="string">"Hostname"</span>: <span class="string">"b8bb78bbe2fb"</span>,</span><br><span class="line">            <span class="string">"Domainname"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"User"</span>: <span class="string">""</span>,</span><br><span class="line">            <span class="string">"AttachStdin"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"AttachStdout"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"AttachStderr"</span>: <span class="literal">true</span>,</span><br><span class="line">            <span class="string">"ExposedPorts"</span>: &#123;</span><br><span class="line">                <span class="string">"80/tcp"</span>: &#123;&#125;</span><br><span class="line">            &#125;,</span><br><span class="line">[root@centos7 _data]<span class="comment"># docker container port pc1</span></span><br><span class="line"><span class="comment">#默认没有端口暴露，虽然在Dockerfile文件中已经定义，由于网络风险需要在启动容器是指定端口暴露</span></span><br><span class="line">这种暴露和存储卷相同，都是宿主机随机动态</span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line"><span class="comment">#####################此时可以手动指定开始端口暴漏##########################</span></span><br><span class="line"><span class="comment">########################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc1 -it -P --rm  mybox:v0.6 /bin/sh</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker container port pc1</span></span><br><span class="line">80/tcp -&gt; 0.0.0.0:32768</span><br></pre></td></tr></table></figure></p>
<p><code>7.Dockerfile文件中ENV指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">[root@centos7 docker]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM     busybox:latest</span><br><span class="line">ENV     webhome=<span class="string">"/data/web/html/"</span></span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">WORKDIR <span class="variable">$&#123;webhome&#125;</span></span><br><span class="line">ADD http://nginx.org/download/nginx-1.14.2.tar.gz <span class="variable">$&#123;webhome&#125;</span></span><br><span class="line">WORKDIR <span class="variable">$&#123;webhome&#125;</span>      </span><br><span class="line">ADD wordpress-4.9-zh_CN.tar.gz ./       </span><br><span class="line">VOLUME <span class="variable">$&#123;webhome&#125;</span></span><br><span class="line">EXPOSE 80/tcp</span><br><span class="line"></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.7</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc2 -it --rm mybox:v0.7 /bin/sh</span></span><br></pre></td></tr></table></figure></p>
<p><code>8.Dockerfile文件中ARG指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">build的时对变量传值的做法</span><br><span class="line"><span class="comment">#Dockerfile中定义了创建容器时的变量参数。如果想临时修改参数可以在命令行中使用ARG定义变量，--build-arg,在执行docker image buil 命令命令行选项可以改变变量的值（docker新版本中支持）</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">##############################使用ARG定义变量##############################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cd /docker/</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM     busybox:latest</span><br><span class="line">ARG     webhome=<span class="string">"/data/web/html/"</span></span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">WORKDIR <span class="variable">$&#123;webhome&#125;</span>         </span><br><span class="line">ADD http://nginx.org/download/nginx-1.14.2.tar.gz <span class="variable">$&#123;webhome&#125;</span>                 </span><br><span class="line">WORKDIR <span class="variable">$&#123;webhome&#125;</span></span><br><span class="line">ADD wordpress-4.9-zh_CN.tar.gz ./     </span><br><span class="line">VOLUME <span class="variable">$&#123;webhome&#125;</span></span><br><span class="line">EXPOSE 80/tcp</span><br><span class="line"></span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line"><span class="comment">#############打镜像，并使用--build-arg指定新的便令再次打镜像################</span></span><br><span class="line"><span class="comment">#########################################################################</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build /docker/ -t mybox:v0.8</span></span><br><span class="line"><span class="comment">#这个镜像执行与EVN执行的镜像一样</span></span><br><span class="line"><span class="comment">#使用--build-arg指定新的变量的值</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker image build --build-arg webhome="/var/www/html" /docker/ -t mybox:v0.7</span></span><br><span class="line">[root@centos7 docker]<span class="comment"># docker run --name pc2 -it --rm mybox:v0.7 /bin/sh</span></span><br><span class="line">/var/www/html <span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<h3 id="run阶段Dockerfile文件中的指令"><a href="#run阶段Dockerfile文件中的指令" class="headerlink" title="run阶段Dockerfile文件中的指令"></a><code>run阶段Dockerfile文件中的指令</code></h3><p><img src="/2019/01/02/dockerfile详解/2019-01-02_143308.png" alt=""></p>
<p>(run阶段：指明在bulid时做一些通过运行shell命令来达到去设定目标镜像的目的）</p>
<ul>
<li><p><code>RUN</code> </p>
<ul>
<li>用于指定docker build过程中运行的程序，其可以是任何命令（run的任何命令代表基础镜像支持的命令） </li>
<li>Syntax <ul>
<li><code>RUN &lt;command&gt; 或</code> #以shell解释运行</li>
<li><code>RUN  [&quot;&lt;executable&gt;&quot;, &quot;&lt;param1&gt;&quot;, &quot;&lt;param2&gt;&quot;]</code> #不以shell解释运行</li>
</ul>
</li>
<li><code>第一种格式中，&lt;command&gt;通常是一个shell命令，且以“/bin/sh -c”来运行它，这意味着此进程 在容器中的PID不为1，不能接收Unix信号，因此，当使用docker stop &lt;container&gt;命令停止容器 时，此进程接收不到SIGTERM信号；</code> </li>
<li><code>第二种语法格式中的参数是一个JSON格式的数组，其中&lt;executable&gt;为要运行的命令，后面的 &lt;paramN&gt;为传递给命令的选项或参数；然而，此种格式指定的命令不会以“/bin/sh -c”来发起 ，因此常见的shell操作如变量替换以及通配符(?,*等)替换将不会进行；不过，如果要运行的命令 依赖于此shell特性的话，可以将其替换为类似下面的格式。</code> <ul>
<li><code>RUN [&quot;/bin/sh&quot;, &quot;-c&quot;, &quot;&lt;executable&gt;&quot;, &quot;&lt;param1&gt;&quot;]</code><ul>
<li>注意：json数组中，要使用双引号</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p><code>CMD</code></p>
<ul>
<li>类似于RUN指令，CMD指令也可用于运行任何命令或应用程序，不过，二者 的运行时间点不同 <ul>
<li>RUN指令运行于映像文件构建过程中，而CMD指令运行于基于Dockerfile构建出的新映像 文件启动一个容器时 </li>
<li>CMD指令的首要目的在于为启动的容器指定默认要运行的程序，且其运行结束后，容器也 将终止；不过，CMD指定的命令其可以被docker run的命令行选项所覆盖 </li>
<li>在Dockerfile中可以存在多个CMD指令，但仅最后一个会生效 </li>
</ul>
</li>
<li>Syntax <ul>
<li><code>CMD &lt;command&gt; 或</code>   #以shell运行</li>
<li><code>CMD [“&lt;executable&gt;”, “&lt;param1&gt;”, “&lt;param2&gt;”] 或</code>    #不以shell解释运行</li>
<li><code>CMD [&quot;&lt;param1&gt;&quot;,&quot;&lt;param2&gt;&quot;]</code></li>
</ul>
</li>
<li>前两种语法格式的意义同RUN </li>
<li>第三种则用于为ENTRYPOINT指令提供默认参数</li>
</ul>
</li>
<li><p><code>ENTRYPOINT</code> </p>
<ul>
<li>类似CMD指令的功能，用于为容器指定默认运行程序，从而使得容器像是一个 单独的可执行程序 </li>
<li>与CMD不同的是，由ENTRYPOINT启动的程序不会被docker run命令行指定的 参数所覆盖，而且，这些命令行参数会被当作参数传递给ENTRYPOINT指定 指定的程序 <ul>
<li>不过，docker run命令的–entrypoint选项的参数可覆盖ENTRYPOINT指令指定的程序 </li>
</ul>
</li>
<li>Syntax <ul>
<li><code>ENTRYPOINT &lt;command&gt;</code> </li>
<li><code>ENTRYPOINT [&quot;&lt;executable&gt;&quot;, &quot;&lt;param1&gt;&quot;, &quot;&lt;param2&gt;&quot;]</code></li>
</ul>
</li>
<li>docker run命令传入的命令参数会覆盖CMD指令的内容并且附加到 ENTRYPOINT命令最后做为其参数使用 </li>
<li>Dockerfile文件中也可以存在多个ENTRYPOINT指令，但仅有最后一个会生效</li>
</ul>
</li>
</ul>
<p><code>Dockerfile文件中RUN指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#运行起来的命令还是shell</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># pwd</span></span><br><span class="line">/dockerlamp</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># cat Dockerfile </span></span><br><span class="line">FROM centos:7</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">ARG root=/var/www/html/</span><br><span class="line">RUN 	 yum makecache &amp;&amp; \</span><br><span class="line">	yum -y install httpd php php-mysql &amp;&amp; \</span><br><span class="line">	yum clean all &amp;&amp; \</span><br><span class="line">	rm -rf /var/cache/yum/* <span class="comment">#删除yum生成的缓存不免刻录至镜像中</span></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 --rm -it lamp:v0.1 /bin/sh</span></span><br><span class="line">sh-4.2<span class="comment"># rpm -q httpd php</span></span><br><span class="line">httpd-2.4.6-88.el7.centos.x86_64</span><br><span class="line">php-5.4.16-46.el7.x86_64</span><br></pre></td></tr></table></figure></p>
<p><code>Dockerfile文件中CMD指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#RUN在bulid阶段</span></span><br><span class="line"><span class="comment">#CMD在run阶段</span></span><br><span class="line"><span class="comment">#实现容器运行起来不是shell而是httpd，实现httpd运行在前台</span></span><br><span class="line"><span class="comment">###################################################################</span></span><br><span class="line">如何实现将httpd实现前台运行</span><br><span class="line">cat /usr/lib/systemd/system/httpd.service </span><br><span class="line">ExecStart=/usr/sbin/httpd <span class="variable">$OPTIONS</span> -DFOREGROUND</span><br><span class="line"><span class="comment">####################################################################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cd /dockerlamp/</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># cat Dockerfile </span></span><br><span class="line">FROM centos:7</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">ARG root=/var/www/html/</span><br><span class="line">RUN 	 yum makecache &amp;&amp; \</span><br><span class="line">	yum -y install httpd php php-mysql &amp;&amp; \</span><br><span class="line">	yum clean all &amp;&amp; \</span><br><span class="line">	rm -rf /var/cache/yum/*</span><br><span class="line">CMD [<span class="string">"usr/sbin/httpd"</span>,<span class="string">"-DFOREGROUND"</span>]</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker image build /dockerlamp/ -t lamp:v0.2</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc2 -it --rm lamp:v0.2 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#烟验证</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker container ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED              STATUS              PORTS               NAMES</span><br><span class="line">f6b5dd3c9664        lamp:v0.2           <span class="string">"usr/sbin/httpd -DFO…"</span>   About a minute ago   Up About a minute                       pc2</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker exec -it pc2  /bin/bash</span></span><br><span class="line">[root@f6b5dd3c9664 /]<span class="comment"># netstat -tnl</span></span><br><span class="line">Active Internet connections (only servers)</span><br><span class="line">Proto Recv-Q Send-Q Local Address           Foreign Address         State      </span><br><span class="line">tcp        0      0 0.0.0.0:80              0.0.0.0:*               LISTEN</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">###########################################################################</span></span><br><span class="line"><span class="comment">####################################改进###################################</span></span><br><span class="line"><span class="comment">##################制作Dockerfile文件并添加测试页打包至镜像###################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># pwd</span></span><br><span class="line">/dockerlamp</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># vim php.php</span></span><br><span class="line">&lt;?php</span><br><span class="line">        phpinfo();</span><br><span class="line">?&gt;</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM centos:7</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">ARG root=/var/www/html/</span><br><span class="line">RUN      yum makecache &amp;&amp; \</span><br><span class="line">        yum -y install httpd php php-mysql &amp;&amp; \</span><br><span class="line">        yum clean all &amp;&amp; \</span><br><span class="line">        rm -rf /var/cache/yum/*</span><br><span class="line">ADD php.php <span class="variable">$&#123;root&#125;</span></span><br><span class="line">CMD [<span class="string">"usr/sbin/httpd"</span>,<span class="string">"-DFOREGROUND"</span>]</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">###############################打镜像并运行容器测试########################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker image build /dockerlamp/ -t lamp:v0.3</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc3 -it --rm lamp:v0.3 </span></span><br><span class="line"></span><br><span class="line"><span class="comment">#测试</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker exec -it pc3 /bin/bash</span></span><br><span class="line">[root@b1da3c0ce6d8 /]<span class="comment"># curl 172.17.0.2</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">###############################说明#######################################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">此时也可以用户在命令行中运行指定使用/bin/bash运行的</span><br><span class="line"><span class="comment">##可以手动指定命令来覆盖镜像Dockerfile文件中CMD的</span></span><br><span class="line"><span class="comment">##上一个镜像文件中默认已经定义运行容器默认运行的进程为httpd的，可以手动运行/bin/bash</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc3 -it --rm lamp:v0.3 /bin/bash</span></span><br><span class="line">[root@97ef0a13d4fc /]<span class="comment"># </span></span><br><span class="line">[root@97ef0a13d4fc /]<span class="comment"># ps aux</span></span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.1  0.1  11820  1884 pts/0    Ss   07:48   0:00 /bin/bash</span><br><span class="line">root         16  0.0  0.0  51740  1732 pts/0    R+   07:49   0:00 ps aux</span><br><span class="line"></span><br><span class="line"><span class="comment">#Dokcerfile文件中定义的运行httpd已经被覆盖，查看进程httpd进程未被启动，如果想要CMD不被覆盖则此时应该用到ENTRYPOINT</span></span><br></pre></td></tr></table></figure></p>
<p><code>Dockerfile文件中ENTRYPOINT指令( --entrypoint )</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#ENTRYPOINT单独使用情况下作用于CMD大致相同除了不可被用户命令行运行容器时任意被覆盖</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">###########################常见Dockerfile文件##############################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># pwd</span></span><br><span class="line">/dockerlamp</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># vim Dockerfile </span></span><br><span class="line"></span><br><span class="line">FROM centos:7</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">ARG root=/var/www/html/</span><br><span class="line">RUN      yum makecache &amp;&amp; \</span><br><span class="line">        yum -y install httpd php php-mysql &amp;&amp; \</span><br><span class="line">        yum clean all &amp;&amp; \</span><br><span class="line">        rm -rf /var/cache/yum/*</span><br><span class="line">ADD php.php <span class="variable">$&#123;root&#125;</span></span><br><span class="line">EXPOSE 80/tcp</span><br><span class="line">VOLUME <span class="variable">$&#123;root&#125;</span></span><br><span class="line">ENTRYPOINT [<span class="string">"usr/sbin/httpd"</span>,<span class="string">"-DFOREGROUND"</span>]</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># ls</span></span><br><span class="line">Dockerfile  php.php</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">###########################打镜像运行容器##################################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker image build /dockerlamp/ -t lamp:v0.4</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 -it -P --rm lamp:v0.4</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">###########################宿主机检测######################################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker container  ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS              PORTS               NAMES</span><br><span class="line">0031f963fce6        lamp:v0.4           <span class="string">"usr/sbin/httpd -DFO…"</span>   41 seconds ago      Up 41 seconds       80/tcp              pc1</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker container port pc1</span></span><br><span class="line">80/tcp -&gt; 0.0.0.0:32769</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># curl 172.18.135.1:32769</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">############测试试图覆盖Docker文件中定义的执行的ENTRYPOINT指令###############</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 -P -it --rm lamp:v0.4 /bin/bash</span></span><br><span class="line">Usage: usr/sbin/httpd [-D name] [-d directory] [-f file]</span><br><span class="line"></span><br><span class="line"><span class="comment">#报错拒绝覆盖Docker文件中定义的执行的ENTRYPOINT指令</span></span><br><span class="line"><span class="comment">#命令行运行时添加的/bin/bash则当作了Docker文件中定义的执行的ENTRYPOINT指令后面的参数（httpd不支持/bin/bash当作参数）</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">########用户执行命令时如何指明强制覆盖Docker文件中定义的执行的ENTRYPOINT指令##</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 -P -it --rm --entrypoint "/bin/bash" lamp:v0.4</span></span><br><span class="line">[root@5de1663077eb /]<span class="comment">#</span></span><br></pre></td></tr></table></figure></p>
<p><code>Dockerfile文件中ENTRYPOINT指令于CMD指令同时使用</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">#CMD定义的命令都要统统作为ENTRYPOINT的参数</span></span><br><span class="line"><span class="comment">#一下两种格式意义相同</span></span><br><span class="line">CMD [<span class="string">"usr/sbin/httpd"</span>,<span class="string">"-DFOREGROUND"</span>]   <span class="comment">#CMD作为ENTRYPOINT的参数执行</span></span><br><span class="line">ENTRYPOINT [<span class="string">"/bin/bash"</span>,<span class="string">"-c"</span>]</span><br><span class="line">=========================================================================</span><br><span class="line">CMD /usr/bin/httpd -DFOREGROUD</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">ENTRYPOINT与CMD分隔开来写的意义：</span><br><span class="line">    在ENTRYPOINT运行一个脚本，CMD的指令会被当作脚本的参数传递给脚本，脚本作为传统应用程序和容器化运行的中间层，来处理配置文件的，同时此配置文件是可以接受环境变量为参数来设置配置文件。</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">###############Dockerfile文件中ENTRYPOINT指令于CMD指令同时使用############</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># vim Dockerfile </span></span><br><span class="line">FROM centos:7</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">ARG root=/var/www/html/</span><br><span class="line">RUN      yum makecache &amp;&amp; \</span><br><span class="line">        yum -y install httpd php php-mysql &amp;&amp; \</span><br><span class="line">        yum clean all &amp;&amp; \</span><br><span class="line">        rm -rf /var/cache/yum/*</span><br><span class="line">ADD php.php <span class="variable">$&#123;root&#125;</span></span><br><span class="line">ADD ent.sh /bin/</span><br><span class="line">EXPOSE 8080/tcp</span><br><span class="line">VOLUME <span class="variable">$&#123;root&#125;</span></span><br><span class="line">CMD [<span class="string">"usr/sbin/httpd"</span>,<span class="string">"-DFOREGROUND"</span>]</span><br><span class="line">ENTRYPOINT [<span class="string">"/bin/ent.sh"</span>]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment">#编写的脚本的解释器一定是基础镜像中所被支持解释的类型</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># vim ent.sh</span></span><br><span class="line"><span class="meta">#!/bin/bash</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment">#如果用户没定义此为默认的变量</span></span><br><span class="line">listen_port=<span class="variable">$&#123;LISTEN_PORT:-8080&#125;</span></span><br><span class="line">server_name=<span class="variable">$&#123;SERVER_NAME:-localhost&#125;</span></span><br><span class="line">doc_root=<span class="variable">$&#123;DOC_ROOT:-/var/www/html&#125;</span></span><br><span class="line"></span><br><span class="line">cat &gt; /etc/httpd/conf.d/myweb.conf &lt;&lt;EOF</span><br><span class="line">listen <span class="variable">$listen_port</span></span><br><span class="line">&lt;VirtualHost *:<span class="variable">$&#123;listen_port&#125;</span>&gt;</span><br><span class="line">        ServerName <span class="string">"<span class="variable">$server_name</span>"</span></span><br><span class="line">        DocumentRoot <span class="string">"<span class="variable">$doc_root</span>"</span></span><br><span class="line">        &lt;Directory <span class="string">"<span class="variable">$doc_root</span>"</span>&gt;</span><br><span class="line">                Options none</span><br><span class="line">                AllowOverride none</span><br><span class="line">                Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">&lt;/Virtualhost&gt;</span><br><span class="line">EOF</span><br><span class="line"><span class="comment">#引用一个脚本的所有参数,默认的httpd进程/bin/bash的子进程&gt;，要想使得httpd作为init下的一级进程则如下写法(目标进程替换shell进程,让shell自动退出)</span></span><br><span class="line"><span class="built_in">exec</span> <span class="string">"<span class="variable">$@</span>"</span></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># chmod +x /dockerlamp/ent.sh </span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker image build /dockerlamp/ -t lamp:v0.5</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 -it --rm lamp:v0.5(可以在命令行中使用-e选项对容器中的环境变量传值 使用printenv命令可以查看传入变量的值 </span></span><br><span class="line">)</span><br><span class="line">[root@centos7 ~]<span class="comment"># docker container port pc1</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># curl 172.18.135.1:32777</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker exec -it pc1 /bin/bash</span></span><br><span class="line">[root@5b32b59d73ef /]<span class="comment"># cat /etc/httpd/conf.d/myweb.conf </span></span><br><span class="line">listen 8080</span><br><span class="line">&lt;VirtualHost *:8080&gt;</span><br><span class="line">        ServerName <span class="string">"localhost"</span></span><br><span class="line">        DocumentRoot <span class="string">"/var/www/html"</span></span><br><span class="line">        &lt;Directory <span class="string">"/var/www/html"</span>&gt;</span><br><span class="line">                Options none</span><br><span class="line">                AllowOverride none</span><br><span class="line">                Require all granted</span><br><span class="line">        &lt;/Directory&gt;</span><br><span class="line">&lt;/Virtualhost&gt;</span><br><span class="line"><span class="comment">#httpd的进程号为1</span></span><br><span class="line">[root@2967451fc4a9 /]<span class="comment"># ps aux</span></span><br><span class="line">USER        PID %CPU %MEM    VSZ   RSS TTY      STAT START   TIME COMMAND</span><br><span class="line">root          1  0.0  0.7 408092 13436 pts/0    Ss+  09:19   0:00 usr/sbin/httpd -DFOREGROUND</span><br><span class="line">apache        8  0.0  0.3 408092  6748 pts/0    S+   09:19   0:00 usr/sbin/httpd -DFOREGROUND</span><br><span class="line">apache        9  0.0  0.3 408092  6748 pts/0    S+   09:19   0:00 usr/sbin/httpd -DFOREGROUND</span><br><span class="line">apache       10  0.0  0.3 408092  6748 pts/0    S+   09:19   0:00 usr/sbin/httpd -DFOREGROUND</span><br><span class="line">apache       11  0.0  0.3 408092  6748 pts/0    S+   09:19   0:00 usr/sbin/httpd -DFOREGROUND</span><br><span class="line">apache       12  0.0  0.3 408092  6748 pts/0    S+   09:19   0:00 usr/sbin/httpd -DFOREGROUND</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">###############run是使用-e选项对容器进行变量复制############################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">(可以在命令行中使用-e选项对容器中的环境变量传值 使用printenv命令可以查看传入变量的值 )</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 -it --rm -P -e LISTEN_PORT=1010 lamp:v0.10</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker exec -it pc1 /bin/bash</span></span><br><span class="line">[root@067566aa1878 /]<span class="comment"># printenv </span></span><br><span class="line">    LISTEN_PORT=1010</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 -it --rm -P -e hi=hehe  lamp:v0.10</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker exec -it pc1 /bin/bash</span></span><br><span class="line">[root@2967451fc4a9 /]<span class="comment"># echo $hi</span></span><br><span class="line">    hehe</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><code>USER</code> </p>
<ul>
<li>用于指定运行image时的或运行Dockerfile中任何RUN、CMD或ENTRYPOINT 指令指定的程序时的用户名或UID </li>
<li>默认情况下，container的运行身份为root用户 </li>
<li>Syntax <ul>
<li>USER <uid>|<username> </username></uid></li>
<li>需要注意的是，<uid>可以为任意数字，但实践中其必须为/etc/passwd中某用户的有效 UID，否则，docker run命令将运行失败</uid></li>
</ul>
</li>
</ul>
</li>
<li><p><code>HEALTHCHECK健康状态检测（新版支持）</code></p>
<ul>
<li>HEALTHCHECK指令告诉Docker如何测试一个容器，以检查它是否仍在工作。这可以检测出一些情况，比如web服务器陷入无限循环，无法处理新连接，即使服务器进程仍在运行。 </li>
<li><p>HEALTHCHECK指令有两种形式:</p>
<ul>
<li>HEALTHCHECK [OPTIONS] CMD命令(通过在容器内运行命令来检查容器的健康状况)</li>
<li>HEALTHCHECK NONE(不做任何健康检测)</li>
</ul>
</li>
<li><p>HEALTHCHECK(2) </p>
</li>
<li>在CMD之前可以出现的选项有:<ul>
<li>–interval=DURATION (default: 30s) #每隔多久检测一次，检测频率默认为30秒</li>
<li>–timeout=DURATION (default: 30s)  #相对方发起检测请求，等待超时时长默认为30秒</li>
<li>–start-period=DURATION (default: 0s) #在什么时间开始进程健康检测，0表示容易以启动立刻做第一次健康检测</li>
<li>–retries=N (default: 3) #检测失败，重试检测多少吃后失败再判定为失败，默认为检测3次</li>
</ul>
</li>
<li>命令的退出状态指示容器的健康状态。可能的值是:<ul>
<li>0: success 成功</li>
<li>1: unhealthy 不健康</li>
<li>2: reserved 保留</li>
</ul>
</li>
<li>范例：<ul>
<li>HEALTHCHECK –interval=5m –timeout=3s \         <ul>
<li>CMD curl -f <a href="http://localhost/" target="_blank" rel="noopener">http://localhost/</a> || exit 1</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>Dockerfile文件中HEALTHCHECK健康状态检测指令（新版支持）</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">##########################定制健康检查计划##################################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># vim /dockerlamp/Dockerfile </span></span><br><span class="line">FROM centos:7</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">ARG root=/var/www/html/</span><br><span class="line">RUN      yum makecache &amp;&amp; \</span><br><span class="line">        yum -y install httpd php php-mysql curl &amp;&amp; \</span><br><span class="line">        yum clean all &amp;&amp; \</span><br><span class="line">        rm -rf /var/cache/yum/*</span><br><span class="line">ADD ok.html php.php <span class="variable">$&#123;root&#125;</span></span><br><span class="line">ADD ent.sh /bin/</span><br><span class="line">EXPOSE 8080/tcp</span><br><span class="line">VOLUME <span class="variable">$&#123;root&#125;</span></span><br><span class="line">HEALTHCHECK --interval=3s --timeout=3s --start-period=2s CMD curl -f http://localhost/ok.html || <span class="built_in">exit</span> 1</span><br><span class="line">CMD [<span class="string">"usr/sbin/httpd"</span>,<span class="string">"-DFOREGROUND"</span>]</span><br><span class="line">ENTRYPOINT [<span class="string">"/bin/ent.sh"</span>]</span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># ls</span></span><br><span class="line">Dockerfile  ent.sh  php.php</span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># echo "ok" &gt; ok.html</span></span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">######################打镜像测试健康计划##################################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker image build /dockerlamp/ -t lamp:v1.0</span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --name pc1 -it --rm lamp:v1.0 </span></span><br><span class="line"><span class="comment">#查看状态健康的</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker ps -a</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                   PORTS               NAMES</span><br><span class="line">763a1536b62d        lamp:v1.0           <span class="string">"/bin/ent.sh usr/sbi…"</span>   6 seconds ago       Up 5 seconds (healthy)   8080/tcp            pc1</span><br><span class="line"></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line"><span class="comment">####################删除文件查看是否不健康##################################</span></span><br><span class="line"><span class="comment">##########################################################################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker exec -it pc1 /bin/bash</span></span><br><span class="line">[root@763a1536b62d /]<span class="comment"># rm -rf /var/www/html/ok.html </span></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker ps</span></span><br><span class="line">CONTAINER ID        IMAGE               COMMAND                  CREATED             STATUS                     PORTS               NAMES</span><br><span class="line">763a1536b62d        lamp:v1.0           <span class="string">"/bin/ent.sh usr/sbi…"</span>   3 minutes ago       Up 3 minutes (unhealthy)   8080/tcp            pc1</span><br><span class="line"></span><br><span class="line"><span class="comment">#一旦发现容器出错时，手动将容器杀死重新构建，此功能是容器引擎做不到的，需要借助容器编排工具</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#如果再构建镜像的时候未构建也可以再运行命令行运行容器时手动指定（人为的在外部定义）</span></span><br><span class="line"></span><br><span class="line">[root@centos7 dockerlamp]<span class="comment"># docker run --help</span></span><br><span class="line"></span><br><span class="line">Usage:	docker run [OPTIONS] IMAGE [COMMAND] [ARG...]</span><br><span class="line">      --health-cmd string              Command to run to check health</span><br><span class="line">      --health-interval duration       Time between running the check (ms|s|m|h)</span><br><span class="line">                                       (default 0s)</span><br><span class="line">      --health-retries int             Consecutive failures needed to report unhealthy</span><br><span class="line">      --health-start-period duration   Start period <span class="keyword">for</span> the container to initialize</span><br><span class="line">                                       before starting health-retries countdown</span><br><span class="line">                                       (ms|s|m|h) (default 0s)</span><br><span class="line">      --health-timeout duration        Maximum time to allow one check to run</span><br></pre></td></tr></table></figure></p>
<ul>
<li><p><code>SHELL</code></p>
<ul>
<li>指令允许覆盖命令的SHELL形式所使用的默认SHELL。</li>
<li>Linux上的默认shell是[“/bin/sh”， “-c”]</li>
<li>Windows上的默认shell是[“cmd”， “/S”， “/C”]</li>
<li>SHELL指令必须以JSON格式写入Dockerfile中</li>
<li>语法:SHELL[“可执行”，”参数”]</li>
<li>外壳指令可以出现多次。每个SHELL指令覆盖前面的所有SHELL指令，并影响后面的所有指令。</li>
</ul>
</li>
<li><p><code>STOPSIGNAL</code></p>
<ul>
<li>指令设置将发送到容器的系统调用信号以退出</li>
<li>这个信号可以是一个有效的无符号数字</li>
<li>它匹配内核的syscall表中的一个位置，例如9</li>
<li>也可以是SIGNAME格式的一个信号名，例如SIGKILL。</li>
<li>Syntax: <ul>
<li>STOPSIGNAL signal</li>
</ul>
</li>
</ul>
</li>
<li><p><code>ONBUILD</code> </p>
<ul>
<li>用于在Dockerfile中定义一个触发器 </li>
<li>Dockerfile用于build映像文件，此映像文件亦可作为base image被另一个Dockerfile 用作FROM指令的参数，并以之构建新的映像文件 </li>
<li>在后面的这个Dockerfile中的FROM指令在build过程中被执行时，将会“触发”创 建其base image的Dockerfile文件中的ONBUILD指令定义的触发器 </li>
<li>Syntax <ul>
<li>ONBUILD <instruction> </instruction></li>
<li>尽管任何指令都可注册成为触发器指令，但ONBUILD不能自我嵌套，且不会触发FROM和 MAINTAINER指令 </li>
<li>使用包含ONBUILD指令的Dockerfile构建的镜像应该使用特殊的标签，例如ruby:2.0-onbuild </li>
<li>在ONBUILD指令中使用ADD或COPY指令应该格外小心，因为新构建过程的上下文在缺少指 定的源文件时会失败</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><code>Dockerfile文件中的ONBUILD指令</code><br><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line">当别人利用自己的镜像做基础镜像</span><br><span class="line">你自己先前定义好的dockerfile，当别人拿自己镜像做基础镜像再次创建的dockerfile文件，自己填写的ONBUILD指令在自己run的时候不会运行，当别人拿自己镜像在此基础上创建的dockerfile执行的时候才会运行自己定义的ONBUILD指令。</span><br><span class="line"></span><br><span class="line"><span class="comment">#定义ONBUILD，当别人拿自己的镜像做基础镜像再次做dockerfile执行时则在/data/data目录中下载URL，自己run时则不执行</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># mkdir /test</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cd /test/</span></span><br><span class="line">[root@centos7 <span class="built_in">test</span>]<span class="comment"># vim Dockerfile</span></span><br><span class="line"></span><br><span class="line">FROM busybox:latest</span><br><span class="line">LABEL   maintainer=<span class="string">"daizhe&lt;daizhe@9527dz.top&gt;"</span></span><br><span class="line">RUN mkdir -p /data/data</span><br><span class="line">ONBUILD ADD http://nginx.org/download/nginx-1.2.9.tar.gz /data/data</span><br><span class="line"><span class="comment">#打镜像</span></span><br><span class="line">[root@centos7 <span class="built_in">test</span>]<span class="comment"># docker image build /test/ -t haha:v0.1</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#在自己制作的基础上再次制作</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># mkdir /test1</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># cd !$</span></span><br><span class="line"><span class="built_in">cd</span> /test1</span><br><span class="line">[root@centos7 test1]<span class="comment"># vim Dockerfile</span></span><br><span class="line">FROM  haha:v0.1</span><br><span class="line">RUN mkdir -p /data/haha</span><br><span class="line"></span><br><span class="line"><span class="comment">#此时第一次制作的镜像定义的ONBUILD 会执行</span></span><br><span class="line">[root@centos7 test1]<span class="comment"># docker image build /test1/ -t hehe:v0.1</span></span><br></pre></td></tr></table></figure></p>
<h3 id="如何将自己本地制作的镜像分享给别人"><a href="#如何将自己本地制作的镜像分享给别人" class="headerlink" title="如何将自己本地制作的镜像分享给别人"></a><code>如何将自己本地制作的镜像分享给别人</code></h3><figure class="highlight bash"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line">此场景适用于内部临时是使用、本地间的节点间共享</span><br><span class="line"></span><br><span class="line">将本地的镜像文件打包，剥离远程镜像仓库的格式，打包未tar文件，实现节点共享</span><br><span class="line"></span><br><span class="line"><span class="comment">#####################抽取本地上的镜像######################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker image ls</span></span><br><span class="line">REPOSITORY               TAG                 IMAGE ID            CREATED             SIZE</span><br><span class="line">hehe                     v0.1                e75cb1954996        7 minutes ago       1.93M</span><br><span class="line">[root@centos7 ~]<span class="comment"># docker image save hehe:v0.1 -o ./jingxiang.tar</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># ls</span></span><br><span class="line">jingxiang.tar</span><br><span class="line"></span><br><span class="line"><span class="comment">#####################复制到其他节点，使用此镜像#################</span></span><br><span class="line">[root@centos7 ~]<span class="comment"># docker image load -i jingxiang.tar</span></span><br></pre></td></tr></table></figure>
      
    </div>

    

    
    
    

<div>
  
      <div>
    
        <div style="text-align:center;color: #FF0000;font-size:16px;">-------------------码字不易<i class="fa fa-heart"></i>尊重原创<i class="fa fa-heart"></i>转载标注<i class="fa fa-heart"></i>不胜感激-------------------</div>
    
</div>
  
</div>
<div>
      
        
      
</div>
    

    
       
    
    
      <div>
        <div style="padding: 10px 0; margin: 20px auto; width: 90%; text-align: center;">
  <div>Yes or no？</div>
  <button id="rewardButton" disable="enable" onclick="var qr = document.getElementById('QR'); if (qr.style.display === 'none') {qr.style.display='block';} else {qr.style.display='none'}">
    <span>打赏</span>
  </button>
  <div id="QR" style="display: none;">

    
      <div id="wechat" style="display: inline-block">
        <img id="wechat_qr" src="/images/wechatpay.jpg" alt="哆啦A梦 微信支付">
        <p>微信支付</p>
      </div>
    

    
      <div id="alipay" style="display: inline-block">
        <img id="alipay_qr" src="/images/alipay.jpg" alt="哆啦A梦 支付宝">
        <p>支付宝</p>
      </div>
    

    

  </div>
</div>

      </div>
    

    

    <footer class="post-footer">
      
        <div class="post-tags">
          
            <a href="/tags/docker/" rel="tag"># docker</a>
          
        </div>
      

      
      
        <div class="post-widgets">
        

        

        
          
          <div class="social_share">
            
               <div>
                 
  <div class="bdsharebuttonbox">
    <a href="#" class="bds_tsina" data-cmd="tsina" title="分享到新浪微博"></a>
    <a href="#" class="bds_douban" data-cmd="douban" title="分享到豆瓣网"></a>
    <a href="#" class="bds_sqq" data-cmd="sqq" title="分享到QQ好友"></a>
    <a href="#" class="bds_qzone" data-cmd="qzone" title="分享到QQ空间"></a>
    <a href="#" class="bds_weixin" data-cmd="weixin" title="分享到微信"></a>
    <a href="#" class="bds_tieba" data-cmd="tieba" title="分享到百度贴吧"></a>
    <a href="#" class="bds_twi" data-cmd="twi" title="分享到Twitter"></a>
    <a href="#" class="bds_fbook" data-cmd="fbook" title="分享到Facebook"></a>
    <a href="#" class="bds_more" data-cmd="more"></a>
    <a class="bds_count" data-cmd="count"></a>
  </div>
  <script>
    window._bd_share_config = {
      "common": {
        "bdText": "",
        "bdMini": "2",
        "bdMiniList": false,
        "bdPic": ""
      },
      "share": {
        "bdSize": "16",
        "bdStyle": "0"
      },
      "image": {
        "viewList": ["tsina", "douban", "sqq", "qzone", "weixin", "twi", "fbook"],
        "viewText": "分享到：",
        "viewSize": "16"
      }
    }
  </script>

<script>
  with(document)0[(getElementsByTagName('head')[0]||body).appendChild(createElement('script')).src='//bdimg.share.baidu.com/static/api/js/share.js?cdnversion='+~(-new Date()/36e5)];
</script>

               </div>
            
            
          </div>
        
        </div>
      
      

      
        <div class="post-nav">
          <div class="post-nav-next post-nav-item">
            
              <a href="/2019/01/01/docker存储卷/" rel="next" title="docker存储卷">
                <i class="fa fa-chevron-left"></i> docker存储卷
              </a>
            
          </div>

          <span class="post-nav-divider"></span>

          <div class="post-nav-prev post-nav-item">
            
              <a href="/2019/01/03/docker私有仓库和资源限制/" rel="prev" title="docker私有仓库">
                docker私有仓库 <i class="fa fa-chevron-right"></i>
              </a>
            
          </div>
        </div>
      

      
      
    </footer>
  </div>
  
  
  
  </article>


  </div>


          </div>
          

  
    <div class="comments" id="comments">
    </div>

  



        </div>
        
          
  
  <div class="sidebar-toggle">
    <div class="sidebar-toggle-line-wrap">
      <span class="sidebar-toggle-line sidebar-toggle-line-first"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-middle"></span>
      <span class="sidebar-toggle-line sidebar-toggle-line-last"></span>
    </div>
  </div>

  <aside id="sidebar" class="sidebar">
    
    <div class="sidebar-inner">

      

      
        <ul class="sidebar-nav motion-element">
          <li class="sidebar-nav-toc sidebar-nav-active" data-target="post-toc-wrap">
            文章目录
          </li>
          <li class="sidebar-nav-overview" data-target="site-overview-wrap">
            站点概览
          </li>
        </ul>
      

      <section class="site-overview-wrap sidebar-panel">
        <div class="site-overview">
          <div class="site-author motion-element" itemprop="author" itemscope="" itemtype="http://schema.org/Person">
            
              <img class="site-author-image" itemprop="image" src="/images/haha.gif" alt="哆啦A梦">
            
              <p class="site-author-name" itemprop="name">哆啦A梦</p>
              <p class="site-description motion-element" itemprop="description">More than that</p>
          </div>

          
            <nav class="site-state motion-element">
              
                <div class="site-state-item site-state-posts">
                
                  <a href="/archives/">
                
                    <span class="site-state-item-count">40</span>
                    <span class="site-state-item-name">日志</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-categories">
                  <a href="/categories/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">11</span>
                    <span class="site-state-item-name">分类</span>
                  </a>
                </div>
              

              
                
                
                <div class="site-state-item site-state-tags">
                  <a href="/tags/index.html">
                    
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                      
                    
                    <span class="site-state-item-count">14</span>
                    <span class="site-state-item-name">标签</span>
                  </a>
                </div>
              
            </nav>
          

          
            <div class="feed-link motion-element">
              <a href="/atom.xml" rel="alternate">
                <i class="fa fa-rss"></i>
                RSS
              </a>
            </div>
          

          
            <div class="links-of-author motion-element">
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://weibo.com/5645211828/profile?rightmod=1&wvr=6&mod=personinfo" title="Weibo &rarr; https://weibo.com/5645211828/profile?rightmod=1&wvr=6&mod=personinfo" rel="noopener" target="_blank"><i class="fa fa-fw fa-weibo"></i>Weibo</a>
                </span>
              
                <span class="links-of-author-item">
                  
                  
                    
                  
                  
                    
                  
                  <a href="https://music.163.com/#/user/home?id=1301458825" title="CloudMusic &rarr; https://music.163.com/#/user/home?id=1301458825" rel="noopener" target="_blank"><i class="fa fa-fw fa-music"></i>CloudMusic</a>
                </span>
              
            </div>
          

          

          
          
          
            
          
          

        </div>
      </section>

      
      <!--noindex-->
        <section class="post-toc-wrap motion-element sidebar-panel sidebar-panel-active">
          <div class="post-toc">

            
              
            

            
              <div class="post-toc-content"><ol class="nav"><li class="nav-item nav-level-1"><a class="nav-link" href="#dockerfile详解"><span class="nav-number">1.</span> <span class="nav-text">dockerfile详解</span></a><ol class="nav-child"><li class="nav-item nav-level-2"><a class="nav-link" href="#docker的镜像分层"><span class="nav-number">1.1.</span> <span class="nav-text">docker的镜像分层</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#About-Dockerfile"><span class="nav-number">1.2.</span> <span class="nav-text">About Dockerfile</span></a></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile"><span class="nav-number">1.3.</span> <span class="nav-text">Dockerfile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#docker镜像制作的两种运行场景"><span class="nav-number">1.3.1.</span> <span class="nav-text">docker镜像制作的两种运行场景</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#dockerfile"><span class="nav-number">1.4.</span> <span class="nav-text">dockerfile</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#环境变量"><span class="nav-number">1.4.1.</span> <span class="nav-text">环境变量</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#dockerignore-file"><span class="nav-number">1.4.2.</span> <span class="nav-text">.dockerignore file</span></a></li></ol></li><li class="nav-item nav-level-2"><a class="nav-link" href="#Dockerfile指令"><span class="nav-number">1.5.</span> <span class="nav-text">Dockerfile指令</span></a><ol class="nav-child"><li class="nav-item nav-level-3"><a class="nav-link" href="#build阶段Dockerfile文件中的指令"><span class="nav-number">1.5.1.</span> <span class="nav-text">build阶段Dockerfile文件中的指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#run阶段Dockerfile文件中的指令"><span class="nav-number">1.5.2.</span> <span class="nav-text">run阶段Dockerfile文件中的指令</span></a></li><li class="nav-item nav-level-3"><a class="nav-link" href="#如何将自己本地制作的镜像分享给别人"><span class="nav-number">1.5.3.</span> <span class="nav-text">如何将自己本地制作的镜像分享给别人</span></a></li></ol></li></ol></li></ol></div>
            

          </div>
        </section>
      <!--/noindex-->
      

      

    </div>
  </aside>


        
      </div>
    </main>

    <footer id="footer" class="footer">
      <div class="footer-inner">
        <div class="copyright">&copy; 2018 – <span itemprop="copyrightYear">2019</span>
  <span class="with-love" id="animate">
    <i class="fa fa-child"></i>
  </span>
  <span class="author" itemprop="copyrightHolder">哆啦A梦</span>

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-area-chart"></i>
    </span>
    
      <span class="post-meta-item-text">站点总字数：</span>
    
    <span title="站点总字数">387k</span>
  

  
    <span class="post-meta-divider">|</span>
    <span class="post-meta-item-icon">
      <i class="fa fa-coffee"></i>
    </span>
    
      <span class="post-meta-item-text">站点阅读时长 &asymp;</span>
    
    <span title="站点阅读时长">5:52</span>
  
</div>








<center>
                <font size="4" color="#FF0000">哆啦A梦已经奔跑:<span id="run_time" style="color:#DB70DB"></span></font>
            </center>

            <script>
                function runTime() {
                    var d = new Date(), str = '';
                    BirthDay = new Date("June 01,2018");
                    today = new Date();
                    timeold = (today.getTime() - BirthDay.getTime());
                    sectimeold = timeold / 1000
                    secondsold = Math.floor(sectimeold);
                    msPerDay = 24 * 60 * 60 * 1000
                    msPerYear = 365 * 24 * 60 * 60 * 1000
                    e_daysold = timeold / msPerDay
                    e_yearsold = timeold / msPerYear
                    daysold = Math.floor(e_daysold);
                    yearsold = Math.floor(e_yearsold);
                    str = yearsold + "年";
                    str += daysold-365 + "天";
                    str += d.getHours() + '时';
                    str += d.getMinutes() + '分';
                    str += d.getSeconds() + '秒';
                    return str;
                }
                setInterval(function () { $('#run_time').html(runTime()) }, 1000);
            </script>
        








        
      </div>
    </footer>

    
      <div class="back-to-top">
        <i class="fa fa-arrow-up"></i>
        
          <span id="scrollpercent"><span>0</span>%</span>
        
      </div>
    

    
	
    

    
  </div>

  

<script type="text/javascript">
  if (Object.prototype.toString.call(window.Promise) !== '[object Function]') {
    window.Promise = null;
  }
</script>














  
    
      
  
  <script type="text/javascript" color="255,0,0" opacity="1" zindex="-1" count="230" src="/lib/canvas-nest/canvas-nest.min.js"></script>













  
  
    <script type="text/javascript" src="/lib/jquery/index.js?v=2.1.3"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.min.js?v=1.2.1"></script>
  

  
  
    <script type="text/javascript" src="/lib/velocity/velocity.ui.min.js?v=1.2.1"></script>
  


  


  <script type="text/javascript" src="/js/src/utils.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/motion.js?v=6.6.0"></script>



  
  


  <script type="text/javascript" src="/js/src/affix.js?v=6.6.0"></script>

  <script type="text/javascript" src="/js/src/schemes/pisces.js?v=6.6.0"></script>



  
  <script type="text/javascript" src="/js/src/scrollspy.js?v=6.6.0"></script>
<script type="text/javascript" src="/js/src/post-details.js?v=6.6.0"></script>



  


  <script type="text/javascript" src="/js/src/bootstrap.js?v=6.6.0"></script>



  



  








  <script src="//cdn1.lncld.net/static/js/3.0.4/av-min.js"></script>
  
  
  <script src="//unpkg.com/valine/dist/Valine.min.js"></script>
  
  <script type="text/javascript">
    var GUEST = ['nick','mail','link'];
    var guest = 'nick,mail';
    guest = guest.split(',').filter(function (item) {
      return GUEST.indexOf(item)>-1;
    });
    new Valine({
        el: '#comments' ,
        verify: true,
        notify: false,
        appId: 'dSJsYJFvGkHjdapdMEMXCnfL-gzGzoHsz',
        appKey: 'yOLhPLlsxYBFYhhzjWECUdsf',
        placeholder: '来了老弟！！！',
        avatar:'monsterid',
        meta:guest,
        pageSize:'10' || 10,
        visitor: false
    });
  </script>



  

  <script type="text/javascript">
    // Popup Window;
    var isfetched = false;
    var isXml = true;
    // Search DB path;
    var search_path = "search.xml";
    if (search_path.length === 0) {
      search_path = "search.xml";
    } else if (/json$/i.test(search_path)) {
      isXml = false;
    }
    var path = "/" + search_path;
    // monitor main search box;

    var onPopupClose = function (e) {
      $('.popup').hide();
      $('#local-search-input').val('');
      $('.search-result-list').remove();
      $('#no-result').remove();
      $(".local-search-pop-overlay").remove();
      $('body').css('overflow', '');
    }

    function proceedsearch() {
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay"></div>')
        .css('overflow', 'hidden');
      $('.search-popup-overlay').click(onPopupClose);
      $('.popup').toggle();
      var $localSearchInput = $('#local-search-input');
      $localSearchInput.attr("autocapitalize", "none");
      $localSearchInput.attr("autocorrect", "off");
      $localSearchInput.focus();
    }

    // search function;
    var searchFunc = function(path, search_id, content_id) {
      'use strict';

      // start loading animation
      $("body")
        .append('<div class="search-popup-overlay local-search-pop-overlay">' +
          '<div id="search-loading-icon">' +
          '<i class="fa fa-spinner fa-pulse fa-5x fa-fw"></i>' +
          '</div>' +
          '</div>')
        .css('overflow', 'hidden');
      $("#search-loading-icon").css('margin', '20% auto 0 auto').css('text-align', 'center');

      
        // ref: https://github.com/ForbesLindesay/unescape-html
        var unescapeHtml = function(html) {
          return String(html)
            .replace(/&quot;/g, '"')
            .replace(/&#39;/g, '\'')
            .replace(/&#x3A;/g, ':')
            // replace all the other &#x; chars
            .replace(/&#(\d+);/g, function (m, p) { return String.fromCharCode(p); })
            .replace(/&lt;/g, '<')
            .replace(/&gt;/g, '>')
            .replace(/&amp;/g, '&');
        };
      

      $.ajax({
        url: path,
        dataType: isXml ? "xml" : "json",
        async: true,
        success: function(res) {
          // get the contents from search data
          isfetched = true;
          $('.popup').detach().appendTo('.header-inner');
          var datas = isXml ? $("entry", res).map(function() {
            return {
              title: $("title", this).text(),
              content: $("content",this).text(),
              url: $("url" , this).text()
            };
          }).get() : res;
          var input = document.getElementById(search_id);
          var resultContent = document.getElementById(content_id);
          var inputEventFunction = function() {
            var searchText = input.value.trim().toLowerCase();
            var keywords = searchText.split(/[\s\-]+/);
            if (keywords.length > 1) {
              keywords.push(searchText);
            }
            var resultItems = [];
            if (searchText.length > 0) {
              // perform local searching
              datas.forEach(function(data) {
                var isMatch = false;
                var hitCount = 0;
                var searchTextCount = 0;
                var title = data.title.trim();
                var titleInLowerCase = title.toLowerCase();
                var content = data.content.trim().replace(/<[^>]+>/g,"");
                
                content = unescapeHtml(content);
                
                var contentInLowerCase = content.toLowerCase();
                var articleUrl = decodeURIComponent(data.url);
                var indexOfTitle = [];
                var indexOfContent = [];
                // only match articles with not empty titles
                if(title != '') {
                  keywords.forEach(function(keyword) {
                    function getIndexByWord(word, text, caseSensitive) {
                      var wordLen = word.length;
                      if (wordLen === 0) {
                        return [];
                      }
                      var startPosition = 0, position = [], index = [];
                      if (!caseSensitive) {
                        text = text.toLowerCase();
                        word = word.toLowerCase();
                      }
                      while ((position = text.indexOf(word, startPosition)) > -1) {
                        index.push({position: position, word: word});
                        startPosition = position + wordLen;
                      }
                      return index;
                    }

                    indexOfTitle = indexOfTitle.concat(getIndexByWord(keyword, titleInLowerCase, false));
                    indexOfContent = indexOfContent.concat(getIndexByWord(keyword, contentInLowerCase, false));
                  });
                  if (indexOfTitle.length > 0 || indexOfContent.length > 0) {
                    isMatch = true;
                    hitCount = indexOfTitle.length + indexOfContent.length;
                  }
                }

                // show search results

                if (isMatch) {
                  // sort index by position of keyword

                  [indexOfTitle, indexOfContent].forEach(function (index) {
                    index.sort(function (itemLeft, itemRight) {
                      if (itemRight.position !== itemLeft.position) {
                        return itemRight.position - itemLeft.position;
                      } else {
                        return itemLeft.word.length - itemRight.word.length;
                      }
                    });
                  });

                  // merge hits into slices

                  function mergeIntoSlice(text, start, end, index) {
                    var item = index[index.length - 1];
                    var position = item.position;
                    var word = item.word;
                    var hits = [];
                    var searchTextCountInSlice = 0;
                    while (position + word.length <= end && index.length != 0) {
                      if (word === searchText) {
                        searchTextCountInSlice++;
                      }
                      hits.push({position: position, length: word.length});
                      var wordEnd = position + word.length;

                      // move to next position of hit

                      index.pop();
                      while (index.length != 0) {
                        item = index[index.length - 1];
                        position = item.position;
                        word = item.word;
                        if (wordEnd > position) {
                          index.pop();
                        } else {
                          break;
                        }
                      }
                    }
                    searchTextCount += searchTextCountInSlice;
                    return {
                      hits: hits,
                      start: start,
                      end: end,
                      searchTextCount: searchTextCountInSlice
                    };
                  }

                  var slicesOfTitle = [];
                  if (indexOfTitle.length != 0) {
                    slicesOfTitle.push(mergeIntoSlice(title, 0, title.length, indexOfTitle));
                  }

                  var slicesOfContent = [];
                  while (indexOfContent.length != 0) {
                    var item = indexOfContent[indexOfContent.length - 1];
                    var position = item.position;
                    var word = item.word;
                    // cut out 100 characters
                    var start = position - 20;
                    var end = position + 80;
                    if(start < 0){
                      start = 0;
                    }
                    if (end < position + word.length) {
                      end = position + word.length;
                    }
                    if(end > content.length){
                      end = content.length;
                    }
                    slicesOfContent.push(mergeIntoSlice(content, start, end, indexOfContent));
                  }

                  // sort slices in content by search text's count and hits' count

                  slicesOfContent.sort(function (sliceLeft, sliceRight) {
                    if (sliceLeft.searchTextCount !== sliceRight.searchTextCount) {
                      return sliceRight.searchTextCount - sliceLeft.searchTextCount;
                    } else if (sliceLeft.hits.length !== sliceRight.hits.length) {
                      return sliceRight.hits.length - sliceLeft.hits.length;
                    } else {
                      return sliceLeft.start - sliceRight.start;
                    }
                  });

                  // select top N slices in content

                  var upperBound = parseInt('1');
                  if (upperBound >= 0) {
                    slicesOfContent = slicesOfContent.slice(0, upperBound);
                  }

                  // highlight title and content

                  function highlightKeyword(text, slice) {
                    var result = '';
                    var prevEnd = slice.start;
                    slice.hits.forEach(function (hit) {
                      result += text.substring(prevEnd, hit.position);
                      var end = hit.position + hit.length;
                      result += '<b class="search-keyword">' + text.substring(hit.position, end) + '</b>';
                      prevEnd = end;
                    });
                    result += text.substring(prevEnd, slice.end);
                    return result;
                  }

                  var resultItem = '';

                  if (slicesOfTitle.length != 0) {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + highlightKeyword(title, slicesOfTitle[0]) + "</a>";
                  } else {
                    resultItem += "<li><a href='" + articleUrl + "' class='search-result-title'>" + title + "</a>";
                  }

                  slicesOfContent.forEach(function (slice) {
                    resultItem += "<a href='" + articleUrl + "'>" +
                      "<p class=\"search-result\">" + highlightKeyword(content, slice) +
                      "...</p>" + "</a>";
                  });

                  resultItem += "</li>";
                  resultItems.push({
                    item: resultItem,
                    searchTextCount: searchTextCount,
                    hitCount: hitCount,
                    id: resultItems.length
                  });
                }
              })
            };
            if (keywords.length === 1 && keywords[0] === "") {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-search fa-5x" /></div>'
            } else if (resultItems.length === 0) {
              resultContent.innerHTML = '<div id="no-result"><i class="fa fa-frown-o fa-5x" /></div>'
            } else {
              resultItems.sort(function (resultLeft, resultRight) {
                if (resultLeft.searchTextCount !== resultRight.searchTextCount) {
                  return resultRight.searchTextCount - resultLeft.searchTextCount;
                } else if (resultLeft.hitCount !== resultRight.hitCount) {
                  return resultRight.hitCount - resultLeft.hitCount;
                } else {
                  return resultRight.id - resultLeft.id;
                }
              });
              var searchResultList = '<ul class=\"search-result-list\">';
              resultItems.forEach(function (result) {
                searchResultList += result.item;
              })
              searchResultList += "</ul>";
              resultContent.innerHTML = searchResultList;
            }
          }

          if ('auto' === 'auto') {
            input.addEventListener('input', inputEventFunction);
          } else {
            $('.search-icon').click(inputEventFunction);
            input.addEventListener('keypress', function (event) {
              if (event.keyCode === 13) {
                inputEventFunction();
              }
            });
          }

          // remove loading animation
          $(".local-search-pop-overlay").remove();
          $('body').css('overflow', '');

          proceedsearch();
        }
      });
    }

    // handle and trigger popup window;
    $('.popup-trigger').click(function(e) {
      e.stopPropagation();
      if (isfetched === false) {
        searchFunc(path, 'local-search-input', 'local-search-result');
      } else {
        proceedsearch();
      };
    });

    $('.popup-btn-close').click(onPopupClose);
    $('.popup').click(function(e){
      e.stopPropagation();
    });
    $(document).on('keyup', function (event) {
      var shouldDismissSearchPopup = event.which === 27 &&
        $('.search-popup').is(':visible');
      if (shouldDismissSearchPopup) {
        onPopupClose();
      }
    });
  </script>





  

  

  

  

  

  
  

  

  

  

  

  

  

</body>
</html>

<!-- 页面点击小红心 -->
<script type="text/javascript" src="/js/src/clicklove.js"></script>